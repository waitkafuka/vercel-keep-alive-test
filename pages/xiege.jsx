import Head from 'next/head';
import React, { useState } from 'react';
import {
  Button, Form, Input, Radio, Textarea, Space, MessagePlugin, loading,
} from 'tdesign-react'; // 按需引入无样式组件代码
import 'tdesign-react/dist/tdesign.css'; // 全局引入所有组件样式代码
import 'tdesign-react/dist/reset.css';
import http from '../assets/js/http';

const { FormItem } = Form;

export default function Names(a, b) {
  const [form] = Form.useForm();
  const [messages, setMessages] = useState('');
  const [isLoading, setIsLoading] = useState('');

  async function onSubmit(e) {
    const results = [];
    setMessages('');
    if (e.validateResult !== true) return;
    const params = form.getFieldsValue(['content']);
    setIsLoading(true);
    http.streamRequest({
      url: '/api/get-xiege',
      data: params,
      onMessage: (result) => {
        results.push(result);
        setMessages(results.join(''));
      },
      onComplete() {
        setIsLoading(false);
      },
      onError(error) {
        MessagePlugin.error(`请求失败:${error}`);
      },
    });
  }

  return (
    <div>
      <Head>
        <title>人工智能写歌</title>
        <link rel="icon" href="https://openaiapi-site.azureedge.net/public-assets/d/ead04ef722/favicon.png" />
      </Head>
      <main className="main">

        <div style={{ textAlign: 'center', marginBottom: '20px' }}>
          <svg t="1679393990190" className="main-logo" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20661" width="128" height="128">
            <path d="M140.9024 258.5088h0.0512c21.6064 0 39.0656 17.5104 39.0656 39.0656v400.7936c0 75.6736 61.3376 137.0112 137.0112 137.0112h401.2544c21.8112 0 39.4752 17.664 39.4752 39.4752 0 21.76-17.5616 39.424-39.3216 39.4752-102.4 0.4096-265.728 0.8704-411.8528 0.8704-93.4912 0-204.7488-64.3072-204.7488-202.6496 0-147.456-0.1024-312.832-0.0512-415.1296 0.1024-21.504 17.5616-38.912 39.1168-38.912z" fill="#6C6CEA" p-id="20662" />
            <path d="M834.2528 93.7472c-79.9232-0.2048-159.8976-0.0512-239.8208-0.0512-80.7936 0-161.536-0.256-242.3296 0.1024-53.504 0.256-86.016 32.8192-86.1184 86.7328-0.3072 160.7168-0.256 321.4336 0 482.1504 0.1024 54.784 33.28 88.4736 87.552 88.576 160.7168 0.3072 321.4336 0.3072 482.1504 0 55.4496-0.1024 87.7056-32.3072 87.808-87.6032 0.256-160.7168 0.256-321.4336 0-482.1504-0.1024-57.1392-31.232-87.6032-89.2416-87.7568zM759.4496 297.472h-122.4192c0 78.336 0.7168 151.7056-0.2048 225.024-0.8704 70.1952-61.6448 119.296-125.9008 103.2704-59.7504-14.8992-94.0032-73.216-76.8512-130.816 16.6912-56.064 77.2096-86.1696 134.5024-66.8672 2.048 0.6656 4.096 1.4336 6.144 2.2016V217.856H759.4496V297.472z" fill="#6C6CEA" p-id="20663" />
            <path d="M923.4432 181.5552c-0.0512-57.1904-31.232-87.6544-89.2416-87.808-79.9232-0.2048-159.8976-0.0512-239.8208-0.0512-80.7936 0-161.536-0.256-242.3296 0.1024-53.504 0.256-86.016 32.8192-86.1184 86.7328-0.3072 160.7168-0.256 321.4336 0 482.1504 0.1024 54.784 33.28 88.4736 87.552 88.576 110.9504 0.2048 221.952 0.2048 332.9024 0.1536 122.1632-94.72 208.8448-232.8064 237.0048-391.2192 0.0512-59.5456 0.1536-119.0912 0.0512-178.6368zM759.4496 297.472h-122.4192c0 78.336 0.7168 151.7056-0.2048 225.024-0.8704 70.1952-61.6448 119.296-125.9008 103.2704-59.7504-14.8992-94.0032-73.216-76.8512-130.816 16.6912-56.064 77.2096-86.1696 134.5024-66.8672 2.048 0.6656 4.096 1.4336 6.144 2.2016V217.856H759.4496V297.472z" fill="#757BF2" p-id="20664" />
            <path d="M317.0816 835.4304c-75.6736 0-137.0112-61.3376-137.0112-137.0112V297.5744c0-21.6064-17.5104-39.0656-39.0656-39.0656h-0.0512a38.9632 38.9632 0 0 0-39.0144 38.9632c0 102.3488 0.0512 267.7248 0.0512 415.1296 0 74.9056 32.6656 128.1024 77.4144 161.1264 38.0416 7.0656 77.2096 10.9568 117.3504 10.9568 87.2448 0 170.3936-17.5616 246.0672-49.3568H317.0816z" fill="#757BF2" p-id="20665" />
            <path d="M434.0736 494.9504c16.6912-56.064 77.2096-86.1696 134.5024-66.8672 2.048 0.6656 4.096 1.4336 6.144 2.2016V217.856h153.7024c12.9024-39.8336 21.9136-81.3568 26.7264-124.2112-53.6064 0-107.2128 0-160.768 0.0512-80.7936 0-161.536-0.256-242.3296 0.1024-53.504 0.256-86.016 32.8192-86.1184 86.7328-0.3072 153.9072-0.256 307.7632-0.0512 461.6704 62.6688-14.4384 121.7536-38.0928 175.8208-69.4784-12.1856-22.9888-15.7696-50.432-7.6288-77.7728z" fill="#8486F8" p-id="20666" />
            <path d="M637.0304 297.472c0 33.8432 0.1536 66.7136 0.2048 99.1232 22.6304-31.0272 42.6496-64.1536 59.4432-99.1232h-59.648zM180.0704 655.872V297.5744c0-21.6064-17.5104-39.0656-39.0656-39.0656h-0.0512a38.9632 38.9632 0 0 0-39.0144 38.9632c0 89.856 0.0512 228.352 0.0512 360.6016 6.8608 0.2048 13.6704 0.512 20.5824 0.512 19.3536 0 38.5024-0.9728 57.4976-2.7136z" fill="#8486F8" p-id="20667" />
            <path d="M525.5168 93.6448c-57.8048-0.0512-115.6608-0.1024-173.4656 0.1536-53.504 0.256-86.016 32.8192-86.1184 86.7328-0.1024 58.624-0.1536 117.248-0.1536 175.872 110.4384-59.9552 201.0112-151.6544 259.7376-262.7584zM180.0704 297.5744c0-21.6064-17.5104-39.0656-39.0656-39.0656h-0.0512a38.9632 38.9632 0 0 0-39.0144 38.9632v120.2176c26.7264-5.9904 52.8384-13.4656 78.1824-22.6816V297.5744z" fill="#8D92F8" p-id="20668" />
          </svg>
        </div>
        <Form colon={false} labelAlign="right" labelWidth="100px" layout="vertical" preventSubmitDefault resetType="empty" showErrorMessage form={form} scrollToFirstError="smooth" submitWithWarningMessage={false} onSubmit={onSubmit} className="form">

          <FormItem
            name="content"
            rules={[
              { required: true, message: '必填', type: 'error' },
              { max: 500, message: '非盈利工具，请最多输入500个字符', type: 'error' },
            ]}
          >
            <Textarea allowInputOverMax={false} autofocus={false} autosize={{ minRows: 5 }} placeholder="请输入你要写的歌的主题" />
          </FormItem>
          <FormItem>
            <Button type="submit" theme="primary" loading={isLoading} block>
              确定
            </Button>
          </FormItem>
          <Textarea
            allowInputOverMax={false}
            autofocus={false}
            autosize={{ minRows: 6 }}
            readonly
            value={messages}
          />
        </Form>
      </main>
    </div>
  );
}
